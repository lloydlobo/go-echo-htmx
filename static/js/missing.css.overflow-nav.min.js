export function makelogger(){return(...t)=>t.at(-1)}function camelToKebab(t){return t.replace(/[A-Z]/g,(t=>"-"+t.toLowerCase()))}export function traverse(t,e,n,r,o={}){const{wrap:i=!0}=o,a=`${t}ElementSibling`,l=()=>i?"next"===t?$(e,n):$$(e,n).at(-1):null;if(!r)return l();let c=r;for(;;){for(;null===c[a];)if(c=c.parentElement,c===e)return l();c=c[a];const t=c.matches(n)?c:$(c,n);if(t)return t}}export function $(t,e){return t.querySelector(e)}export function $$(t,e){return Array.from(t.querySelectorAll(e))}export function on(t,e,n,r={}){const o=i=>(r.addedBy&&!r.addedBy.isConnected&&off({target:t,type:e,listener:o,options:r}),window,n(i));return t.addEventListener(e,o,r),{target:t,type:e,options:r,listener:o}}export function off({target:t,type:e,listener:n,options:r}){return t.removeEventListener(e,n,r)}export function halt(t,e){for(const n of t.split(" "))"default"===n&&e.preventDefault(),"bubbling"===n&&e.stopPropagation(),"propagation"===n&&e.stopImmediatePropagation()}export function halts(t,e){return n=>{halt(t,n),e(n)}}export function dispatch(t,e,n,r){return t.dispatchEvent(new CustomEvent(e,{...r,detail:n}))}export function attr(t,e,n){if("object"==typeof e){for(const n in e)t.setAttribute(camelToKebab(n),String(e[n]));return null}{const r=t.getAttribute(e);return void 0===n?t.getAttribute(e):null===n?(t.removeAttribute(e),r):(t.setAttribute(e,String(n)),String(n))}}export function mkid(){return Array.from({length:21},(()=>"useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[64*Math.random()|0])).join("")}export function identify(t){return t.id?t.id:t.id=mkid()}export function stringifyNode(t){const e=document.createElement("div");return e.append(t),e.innerHTML}export function htmlescape(t){return null==t?"":t instanceof Node?stringifyNode(t):String(t).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll("'","&#x27;").replaceAll('"',"&quot;")}export function html(t,...e){const n=document.createElement("template");return"object"==typeof t&&"raw"in t&&(t=String.raw(t,...e.map(htmlescape))),n.innerHTML=t,n.content}export function css(t,...e){const n=new CSSStyleSheet;return"object"==typeof t&&"raw"in t&&(t=String.raw(t,...e)),n.replaceSync(t),n}export function style(t,...e){const n=new CSSStyleDeclaration;return"object"==typeof t&&"raw"in t&&(t=String.raw(t,...e)),n.cssText=t,n}export function asHtml(t){return t instanceof HTMLElement?t:null}export function next(t,e,n,r={}){return traverse("next",t,e,n,r)}export function prev(t,e,n,r={}){return traverse("previous",t,e,n,r)}export function hotkey(t){const e={},n=t=>{const e=t.split("+"),n=e.pop();let r=0;for(const t in e)switch(t.toLowerCase()){case"alt":r|=1;break;case"ctrl":r|=2;break;case"meta":r|=4;break;case"shift":r|=8}return[n,r]};for(const[r,o]of Object.entries(t)){const[t,i]=n(r);(e[t]??=new Array(8))[i]=o}return t=>e[t.key]?.[(t=>~~(t.altKey&&1)|~~(t.ctrlKey&&2)|~~(t.metaKey&&4)|~~(t.shiftKey&&8))(t)]?.(t)}export function debounce(t,e,{mode:n="trailing"}={}){let r=null;return(...o)=>{r?clearTimeout(r):"leading"===n&&e(...o),r=setTimeout((()=>{"trailing"===n&&e(...o),r=null}),t)}}export function behavior(t,e){const n=new WeakSet;return(r=document,o={})=>{const i=r.getRootNode();$$(r,t).forEach((t=>{n.has(t)||(n.add(t),e(t,{options:o,root:i}))}))}}export function repeater(t,e){return n=>{let r=null;const o=(...e)=>{const n=r;r=e.at(-1),r instanceof DocumentFragment&&(r=r.lastChild),n?n.after(...e):t.prepend(...e)},i=t.getRootNode();for(const t of n){const n=e.idOf(t),r=i.getElementById(n);o(r?e.update?.(r,t)??r:e.create(t,{id:n}))}(e=>{if(e)for(;e.nextSibling;)e.nextSibling.remove();else t.replaceChildren()})(r)}}const ilog=makelogger("overflow-nav"),overflowNav=behavior("[data-overflow-nav]",((t,{options:{expandedClass:e="expanded"}})=>{const n=asHtml($(t,"[data-nav-expander]"));if(null===n)return ilog("Expand toggle missing from navbar ",t);const r=(r=!(()=>t.classList.contains(e))())=>{r?(t.classList.add(e),attr(n,"aria-pressed",!0),n.textContent="×"):(t.classList.remove(e),attr(n,"aria-pressed",!1),n.textContent="☰")},o=()=>{const e=n.hidden;n.hidden=!(t.scrollWidth>t.clientWidth),e!=n.hidden&&r(!1)};on(n,"click",(()=>r())),o(),on(window,"resize",(()=>o()),{addedBy:t})}));export default overflowNav;overflowNav(document);